---
replicaCount: 1

image:
  repository: ""
  pullPolicy: IfNotPresent
  tag: ""

nameOverride: ""
fullnameOverride: ""

containerPort: 8080

# --- Service Account & IRSA ---
serviceAccount:
  create: true
  name: ""
  annotations: {}
    # eks.amazonaws.com/role-arn: arn:aws:iam::ACCOUNT_ID:role/my-app-role
  labels: {}

# --- Pod Security ---
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65534
  runAsGroup: 65534
  fsGroup: 65534
  seccompProfile:
    type: RuntimeDefault

containerSecurityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop: [ALL]

# --- Resources ---
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 256Mi

# --- Health Probes ---
probes:
  liveness:
    enabled: true
    httpGet:
      path: /healthz
      port: http
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 3
    failureThreshold: 3
  readiness:
    enabled: true
    httpGet:
      path: /readyz
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  startup:
    enabled: false
    httpGet:
      path: /healthz
      port: http
    initialDelaySeconds: 0
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 30

# --- Graceful Shutdown ---
terminationGracePeriodSeconds: 35
lifecycle:
  preStop:
    exec:
      command: ["/bin/sh", "-c", "sleep 5"]

# --- Environment Variables ---
env: []
  # - name: LOG_LEVEL
  #   value: "info"
  # - name: GOMAXPROCS
  #   valueFrom:
  #     resourceFieldRef:
  #       resource: limits.cpu

envFrom: []

# --- Service ---
service:
  type: ClusterIP
  port: 80
  annotations: {}
  # Cilium ClusterMesh global service â€” makes this service discoverable across clusters.
  # Traffic prefers the local cluster; fails over to remote if local pods are unhealthy.
  global: false
  # Affinity: "local" (prefer local, failover remote), "remote" (prefer remote), "none" (round-robin)
  globalAffinity: local
  # Shared: when true, load-balances across local AND remote pods simultaneously
  shared: false

# --- Ingress ---
ingress:
  enabled: false
  className: alb
  extraClasses: []
  annotations: {}
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

# --- External Secrets ---
externalSecrets:
  enabled: false
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore
  data: []

# --- Pod Disruption Budget ---
podDisruptionBudget:
  enabled: true
  minAvailable: 1
  # maxUnavailable: 25%

# --- Topology Spread & Affinity ---
topologySpreadConstraints:
  - maxSkew: 1
    topologyKey: topology.kubernetes.io/zone
    whenUnsatisfiable: DoNotSchedule
  - maxSkew: 1
    topologyKey: kubernetes.io/hostname
    whenUnsatisfiable: ScheduleAnyway

affinity: {}
nodeSelector: {}
tolerations: []

# --- Autoscaling ---
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 75
    - type: Resource
      resource:
        name: memory
        target:
          type: Utilization
          averageUtilization: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
        - type: Percent
          value: 25
          periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 30
      policies:
        - type: Percent
          value: 100
          periodSeconds: 30

# --- ServiceMonitor (Prometheus) ---
serviceMonitor:
  enabled: false
  interval: 15s
  path: /metrics
  port: http
  namespace: ""
  additionalLabels: {}
  scrapeTimeout: 10s

# --- Network Policy ---
networkPolicy:
  enabled: true
  ingress:
    - from:
        - podSelector: {}  # same namespace
      ports:
        - protocol: TCP
          port: http
  egress:
    - to: []  # allow all egress by default
    # DNS egress is always allowed

# --- Jobs ---
jobs: []
  # - name: migrate
  #   image: ""
  #   command: ["/app/migrate"]
  #   env: []
  #   restartPolicy: OnFailure
  #   backoffLimit: 3
  #   hookWeight: "-5"  # runs before deployment

# --- CronJobs ---
cronJobs: []
  # - name: cleanup
  #   schedule: "0 2 * * *"
  #   image: ""
  #   command: ["/app/cleanup"]
  #   env: []
  #   restartPolicy: OnFailure
  #   concurrencyPolicy: Forbid
  #   successfulJobsHistoryLimit: 3
  #   failedJobsHistoryLimit: 3

# --- Init Containers ---
initContainers: []
  # - name: migrate
  #   image: ""
  #   command: ["/app/migrate", "up"]

# --- Labels & Annotations ---
labels: {}
podAnnotations: {}
